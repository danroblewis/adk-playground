id: ea6012c0
name: Iterative Writer
description: Demo of LoopAgent with author/critic workflow
app:
  id: app_ea6012c0
  name: Iterative Writer
  description: ''
  root_agent_id: agent_loop
  session_service_uri: memory://
  memory_service_uri: memory://
  artifact_service_uri: memory://
  compaction:
    enabled: false
    max_events: 100
    summarize: true
  context_cache:
    enabled: false
    ttl_seconds: 3600
  resumability:
    enabled: false
  plugins:
  - type: ReflectAndRetryToolPlugin
    name: reflect_retry
    max_retries: 3
    throw_exception_if_retry_exceeded: false
  state_keys:
  - name: story
    description: story
    type: string
    default_value: null
    scope: session
  artifacts: []
  models:
  - id: model_miw9xh0n
    name: New Model
    provider: litellm
    model_name: ollama/qwen3:8b
    api_base: http://node1:11434
    temperature: null
    max_output_tokens: null
    top_p: null
    top_k: null
    is_default: true
  default_model_id: model_miw9xh0n
agents:
- type: LlmAgent
  id: agent_writer
  name: writer
  description: Writes and refines a story iteratively
  model:
    provider: litellm
    model_name: ollama/qwen3:8b
    api_base: http://node1:11434
    fallbacks: []
    temperature: null
    max_output_tokens: null
    top_p: null
    top_k: null
  instruction: You are a creative writer.
  output_key: null
  include_contents: default
  disallow_transfer_to_parent: false
  disallow_transfer_to_peers: false
  tools: []
  sub_agents: []
  before_agent_callbacks: []
  after_agent_callbacks: []
  before_model_callbacks: []
  after_model_callbacks: []
  before_tool_callbacks: []
  after_tool_callbacks: []
- type: LoopAgent
  id: agent_loop
  name: refinement_loop
  description: Loops author/critic until satisfied
  sub_agents:
  - agent_author_critic
  max_iterations: 3
- type: LlmAgent
  id: agent_author
  name: author
  description: Story author
  model:
    provider: litellm
    model_name: ollama/qwen3:8b
    api_base: http://node1:11434
    fallbacks: []
    temperature: null
    max_output_tokens: null
    top_p: null
    top_k: null
  instruction: "You are a creative writer tasked with crafting a concise, emotionally\
    \ resonant story within a collaborative refinement loop. Your role is to generate\
    \ a 2-3 sentence narrative that establishes a clear beginning, develops a relatable\
    \ conflict or moment, and concludes with impactful imagery or emotion. Work within\
    \ the refinement_loop system by:  \n1. **Writing the story** based on the provided\
    \ topic and any feedback from the critic agent, ensuring each iteration improves\
    \ clarity, emotional depth, or vividness.  \n2. **Outputting only the story text**\
    \ (no explanations, metadata, headers, or markdown), strictly adhering to the\
    \ language of the input prompt (e.g., if the prompt is in English, the story must\
    \ be in English).  \n3. **Revising iteratively** based on the critic\u2019s feedback:\
    \ carefully review all suggested changes, address each point explicitly, and submit\
    \ a refined version that balances brevity with emotional resonance.  \n4. **Adhering\
    \ to structure**: Ensure the story has a clear beginning (establishing context),\
    \ a relatable conflict or turning point, and a conclusion that evokes imagery\
    \ or emotion. Prioritize sensory details and character-driven moments.  \n5. **Loop\
    \ integration**: The refinement_loop will cycle through author and critic agents\
    \ until the critic approves the story. Your task is to refine your draft until\
    \ it meets the critic\u2019s standards for coherence, impact, and concision. \
    \ \n6. **Constraints**: Do not include any formatting, explanations, or self-references.\
    \ Focus solely on the narrative. If feedback is ambiguous, revise to strengthen\
    \ emotional clarity or structural flow.  \n7. **Tool usage**: While you do not\
    \ have direct tools, your output will trigger the critic agent\u2019s evaluation,\
    \ which may decide to exit the loop or request further revisions. Respond to all\
    \ feedback systematically.  \n\nExample: If the topic is \u201Ca lonely sailor\
    \ on a stormy night,\u201D your story might begin with sensory details of the\
    \ sea, introduce a conflict (e.g., a failing compass), and end with a metaphorical\
    \ or emotional resolution (e.g., \u201Cthe horizon blurred into a single tear\u201D\
    )."
  output_key: story
  include_contents: default
  disallow_transfer_to_parent: false
  disallow_transfer_to_peers: false
  tools: []
  sub_agents: []
  before_agent_callbacks: []
  after_agent_callbacks: []
  before_model_callbacks: []
  after_model_callbacks: []
  before_tool_callbacks: []
  after_tool_callbacks: []
- type: LlmAgent
  id: agent_critic
  name: critic
  description: Reviews the story and decides to approve or request changes
  model:
    provider: litellm
    model_name: ollama/qwen3:8b
    api_base: http://node1:11434
    fallbacks: []
    temperature: null
    max_output_tokens: null
    top_p: null
    top_k: null
  instruction: 'You are a story critic. Review the current story from state key "story".


    If the story is good (has a clear beginning, vivid descriptions, and emotional
    impact), call exit_loop() to approve it.


    If it needs improvement, provide specific feedback that will be used to improve
    the story. Do NOT call exit_loop if improvements are needed.'
  output_key: null
  include_contents: default
  disallow_transfer_to_parent: false
  disallow_transfer_to_peers: false
  tools:
  - type: builtin
    name: exit_loop
  sub_agents: []
  before_agent_callbacks: []
  after_agent_callbacks: []
  before_model_callbacks: []
  after_model_callbacks: []
  before_tool_callbacks: []
  after_tool_callbacks: []
- type: SequentialAgent
  id: agent_author_critic
  name: author_critic_sequence
  description: Runs author then critic in sequence
  sub_agents:
  - agent_author
  - agent_critic
custom_tools:
- id: tool_miwgt3wz
  name: save_story
  description: save_story
  module_path: tools.custom
  code: "def save_story(tool_context: ToolContext, param1: str) -> dict:\n    \"\"\
    \"Description of what this tool does.\n    \n    Args:\n        param1: Description\
    \ of this parameter\n    \n    Returns:\n        A dictionary with the result\n\
    \    \"\"\"\n    # Access state: tool_context.state['key']\n    # Set state: tool_context.state['key']\
    \ = value\n    \n    return {\"result\": \"success\"}\n"
  state_keys_used: []
mcp_servers: []
